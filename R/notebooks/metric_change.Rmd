---
title: "Changes"
author: "Jens Laufer"
date: "18 11 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F, warning = F)
```


```{r}
source("../apps/api.R")
```


```{r}
data <- load.data()
```


```{r}
data <- data %>% 
  filter(is.na(ParentCategory)) %>% 
  filter(Id ==  "SINGORAMA") %>% 
  group_by(Id) %>% 
  mutate(lag = dplyr::lag(Gravity), pct_change= (Gravity - dplyr::lag(Gravity)) / dplyr::lag(Gravity)) %>% 
  ungroup() 
```

```{r}
data %>% 
  select(Id, Date, Category, Gravity, lag, pct_change) %>% 
  filter(pct_change >0) %>% 
  filter(Id == "SINGORAMA") %>% 
  arrange(Date)
```

```{r}
library(lubridate)
grp1 <- tibble(time=seq(ymd('2000-01-01'),ymd('2000-01-06'), by="1 day"), gr=as.factor(c("1", "1", "1", "1", "1","1")), val1=c(4,5,6,7,2,5), val2=c(-1,-2,4,0,-3,-5)) 

grp2 <- tibble(time=seq(ymd('2000-01-01'),ymd('2000-01-06'), by="1 day"), gr=as.factor(c("2", "2", "2", "2", "2","2")), val1=c(10,6,7,6,8,9), val2=c(1,3,8,-1,-3,-7))
data2 <- grp1 %>% bind_rows(grp2)
data2
```

```{r}
data2 %>%
  filter(gr == "1") %>%
  mutate_at(vars(contains('val')), list(change = ~ (. / lag(.) - 0))) 
```

